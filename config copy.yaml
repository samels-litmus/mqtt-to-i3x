# i3x-via-mqtt Configuration File
# This file configures the MQTT-to-i3x bridge

# =============================================================================
# Server Configuration
# =============================================================================
server:
  port: 3000
  host: "0.0.0.0"
  tls:
    key: "i3x-testing-20260203.key"
    cert: "i3x-testing-20260203.crt"
  # Uncomment for HTTPS:
  # tls:
  #   key: "/path/to/server.key"
  #   cert: "/path/to/server.crt"
  #   ca: "/path/to/ca.crt"  # Optional

# =============================================================================
# Authentication
# =============================================================================
auth:
  enabled: false  # Set to true to require API key authentication
  apiKeys:
    - "" # Add valid API keys here

# =============================================================================
# MQTT Broker Connection
# =============================================================================
mqtt:
  brokerUrl: "mqtt://virtualfactory.proveit.services:1883"
  username: "proveitreadonly"
  password: "proveitreadonlypassword"
  clientId: "i3x-server"  # Will be suffixed with timestamp
  clean: true
  keepalive: 60
  reconnectPeriod: 5000
  protocolVersion: 5

# =============================================================================
# Namespaces
# Dynamically created from MQTT topic structure. Seed with a default.
# =============================================================================
namespaces:
  - uri: "urn:mqtt:default"
    displayName: "Default MQTT Namespace"

# =============================================================================
# Namespaces
# Define the i3x namespaces for organizing objects
# =============================================================================
namespaces:
  - uri: "urn:proveit:enterprise-a"
    displayName: "Enterprise A"

  - uri: "urn:proveit:enterprise-b"
    displayName: "Enterprise B"

  - uri: "urn:proveit:enterprise-c"
    displayName: "Enterprise C"

  - uri: "urn:proveit:default"
    displayName: "Default Namespace"

# =============================================================================
# Object Types
# Define the types of industrial objects we're tracking
# =============================================================================
objectTypes:
  # Temperature sensors
  - elementId: "TemperatureSensor"
    displayName: "Temperature Sensor"
    namespaceUri: "urn:proveit:default"
    schema:
      type: "object"
      properties:
        value: { type: "number" }
        unit: { type: "string", enum: ["celsius", "fahrenheit"] }

  # Flow sensors
  - elementId: "FlowSensor"
    displayName: "Flow Sensor"
    namespaceUri: "urn:proveit:default"
    schema:
      type: "object"
      properties:
        value: { type: "number" }
        unit: { type: "string", enum: ["gpm", "lpm"] }

  # Pressure sensors
  - elementId: "PressureSensor"
    displayName: "Pressure Sensor"
    namespaceUri: "urn:proveit:default"
    schema:
      type: "object"
      properties:
        value: { type: "number" }
        unit: { type: "string", enum: ["psi", "bar", "kpa"] }

  # Level sensors
  - elementId: "LevelSensor"
    displayName: "Level Sensor"
    namespaceUri: "urn:proveit:default"
    schema:
      type: "object"
      properties:
        value: { type: "number" }
        unit: { type: "string", enum: ["percent", "meters"] }

  # Pumps
  - elementId: "Pump"
    displayName: "Pump"
    namespaceUri: "urn:proveit:default"
    schema:
      type: "object"
      properties:
        running: { type: "boolean" }
        speed: { type: "number" }

  # Valves
  - elementId: "Valve"
    displayName: "Valve"
    namespaceUri: "urn:proveit:default"
    schema:
      type: "object"
      properties:
        position: { type: "number", minimum: 0, maximum: 100 }
        open: { type: "boolean" }

  # Motors
  - elementId: "Motor"
    displayName: "Motor"
    namespaceUri: "urn:proveit:default"
    schema:
      type: "object"
      properties:
        running: { type: "boolean" }
        rpm: { type: "number" }
        current: { type: "number" }

  # Generic tag for unclassified data
  - elementId: "GenericTag"
    displayName: "Generic Tag"
    namespaceUri: "urn:proveit:default"
    schema:
      type: "object"

# =============================================================================
# Mapping Rules
# Define how MQTT topics map to i3x objects
# =============================================================================
mappings:
  # ---------------------------------------------------------------------------
  # Enterprise Three-Level Pattern: {enterprise}/{system}/{tag}
  # Examples: "Enterprise A/sub/TI-100-001_PV_Celsius"
  # ---------------------------------------------------------------------------
  - id: "enterprise-three-level"
    topicPattern: "{enterprise}/{system}/{tag}"
    codec: "json"
    namespaceUri: "urn:proveit:{enterprise}"
    objectTypeId: "{system}"
    elementIdTemplate: "{enterprise}.{system}.{tag}"
    displayNameTemplate: "{tag}"

  # ---------------------------------------------------------------------------
  # Enterprise Two-Level Pattern: {enterprise}/{tag}
  # Examples: "Enterprise A/SomeDirectTag"
  # ---------------------------------------------------------------------------
  - id: "enterprise-two-level"
    topicPattern: "{enterprise}/{tag}"
    codec: "json"
    namespaceUri: "urn:proveit:{enterprise}"
    objectTypeId: "GenericTag"
    elementIdTemplate: "{enterprise}.{tag}"
    displayNameTemplate: "{tag}"

  # ---------------------------------------------------------------------------
  # Sparkplug B Pattern (if used)
  # Format: spBv1.0/{group_id}/DDATA/{edge_node_id}/{device_id}
  # ---------------------------------------------------------------------------
  - id: "sparkplug-device-data"
    topicPattern: "spBv1.0/{group}/{type}/{edge}/{device}"
    codec: "sparkplug"
    namespaceUri: "urn:sparkplug:{group}"
    objectTypeId: "{type}"
    elementIdTemplate: "{group}.{edge}.{device}"
    displayNameTemplate: "{device}"

  # ---------------------------------------------------------------------------
  # OPC UA PubSub Pattern (if used)
  # Format: opcua/{namespace}/{node}
  # ---------------------------------------------------------------------------
  - id: "opcua-pubsub"
    topicPattern: "opcua/{namespace}/{node}"
    codec: "json"
    namespaceUri: "urn:opcua:{namespace}"
    objectTypeId: "OpcUaNode"
    elementIdTemplate: "opcua.{namespace}.{node}"
    displayNameTemplate: "{node}"

  # ---------------------------------------------------------------------------
  # Temperature Sensors (specific pattern)
  # Matches: */*/TI-*
  # ---------------------------------------------------------------------------
  - id: "temperature-sensors"
    topicPattern: "{enterprise}/{system}/TI-{tagId}"
    codec: "json"
    namespaceUri: "urn:proveit:{enterprise}"
    objectTypeId: "TemperatureSensor"
    elementIdTemplate: "{enterprise}.{system}.TI-{tagId}"
    displayNameTemplate: "Temperature TI-{tagId}"

  # ---------------------------------------------------------------------------
  # Flow Sensors (specific pattern)
  # Matches: */*/FI-*
  # ---------------------------------------------------------------------------
  - id: "flow-sensors"
    topicPattern: "{enterprise}/{system}/FI-{tagId}"
    codec: "json"
    namespaceUri: "urn:proveit:{enterprise}"
    objectTypeId: "FlowSensor"
    elementIdTemplate: "{enterprise}.{system}.FI-{tagId}"
    displayNameTemplate: "Flow FI-{tagId}"

  # ---------------------------------------------------------------------------
  # Pressure Sensors (specific pattern)
  # Matches: */*/PI-*
  # ---------------------------------------------------------------------------
  - id: "pressure-sensors"
    topicPattern: "{enterprise}/{system}/PI-{tagId}"
    codec: "json"
    namespaceUri: "urn:proveit:{enterprise}"
    objectTypeId: "PressureSensor"
    elementIdTemplate: "{enterprise}.{system}.PI-{tagId}"
    displayNameTemplate: "Pressure PI-{tagId}"

  # ---------------------------------------------------------------------------
  # Level Sensors (specific pattern)
  # Matches: */*/LI-*
  # ---------------------------------------------------------------------------
  - id: "level-sensors"
    topicPattern: "{enterprise}/{system}/LI-{tagId}"
    codec: "json"
    namespaceUri: "urn:proveit:{enterprise}"
    objectTypeId: "LevelSensor"
    elementIdTemplate: "{enterprise}.{system}.LI-{tagId}"
    displayNameTemplate: "Level LI-{tagId}"

  # ---------------------------------------------------------------------------
  # Pumps (specific pattern)
  # Matches: */*/P-*
  # ---------------------------------------------------------------------------
  - id: "pumps"
    topicPattern: "{enterprise}/{system}/P-{tagId}"
    codec: "json"
    namespaceUri: "urn:proveit:{enterprise}"
    objectTypeId: "Pump"
    elementIdTemplate: "{enterprise}.{system}.P-{tagId}"
    displayNameTemplate: "Pump P-{tagId}"

  # ---------------------------------------------------------------------------
  # Valves (specific pattern)
  # Matches: */*/V-* or */*/XV-*
  # ---------------------------------------------------------------------------
  - id: "valves"
    topicPattern: "{enterprise}/{system}/V-{tagId}"
    codec: "json"
    namespaceUri: "urn:proveit:{enterprise}"
    objectTypeId: "Valve"
    elementIdTemplate: "{enterprise}.{system}.V-{tagId}"
    displayNameTemplate: "Valve V-{tagId}"

  # ---------------------------------------------------------------------------
  # Motors (specific pattern)
  # Matches: */*/M-*
  # ---------------------------------------------------------------------------
  - id: "motors"
    topicPattern: "{enterprise}/{system}/M-{tagId}"
    codec: "json"
    namespaceUri: "urn:proveit:{enterprise}"
    objectTypeId: "Motor"
    elementIdTemplate: "{enterprise}.{system}.M-{tagId}"
    displayNameTemplate: "Motor M-{tagId}"
